var locationUrl=window.location.href;if(locationUrl.indexOf("pan.baidu.com/share/")!=-1){if($("#accessCode")){chrome.runtime.sendMessage({action:"getAutoLoginPswd"},function(response){if(response.autoLoginPswd){var sPswd=response.autoLoginPswd;$("#accessCode").val(sPswd);$("#submitBtn").click()}else{console.log("无密码！")}})}}function getBdysls(){var sBdysOpenUrlHttp="http";var reg=/pan\.baidu\.com\/s\/[a-zA-Z0-9]{3,8}(([\s\r]*)密码(：|:|∶)?(\s)?([a-zA-Z0-9]{4}|((\u4e00-\u9fa5){1}(a-zA-Z0-9){1})))?/g;var aBdys=[];var oBdyslist="";if($("html").text().match(reg)){aBdys=$("html").text().match(reg)}if(aBdys.length>0){for(var i=0;i<aBdys.length;i++){var _reg=new RegExp(/密码/);var _str="";if(_reg.test(aBdys[i])){_str=aBdys[i].replace(/(pan\.baidu\.com\/s\/[a-zA-Z0-9]{3,8})(([\s\r]*)密码(：|:|∶)?(\s)?)([a-zA-Z0-9]{4}|((\u4e00-\u9fa5){1}(a-zA-Z0-9){1}))/g,'{"link":"$1", "pswd":"$6"}')}else{_str=aBdys[i].replace(/(pan\.baidu\.com\/s\/[a-zA-Z0-9]{3,8})/g,'{"link":"$1"}')}aBdys[i]=JSON.parse(_str)}for(var j=0;j<aBdys.length;j++){var oBdyslistAtitle="";if(aBdys[j].pswd){oBdyslistAtitle="地址："+aBdys[j].link+"\n密码："+aBdys[j].pswd;oBdyslist+='<p><a href="'+sBdysOpenUrlHttp+"://"+aBdys[j].link+'" data-pswd="'+aBdys[j].pswd+'" target="_blank" title="'+oBdyslistAtitle+'">'+(j+1)+"、"+aBdys[j].link+"</a></p>"}else{oBdyslistAtitle="地址："+aBdys[j].link;oBdyslist+='<p><a href="'+sBdysOpenUrlHttp+"://"+aBdys[j].link+'" target="_blank" title="'+oBdyslistAtitle+'">'+(j+1)+"、"+aBdys[j].link+"</a></p>"}}}else{oBdyslist='<p style="color: #ccc;">未发现百度云分享链接！</p>'}chrome.runtime.sendMessage({badge:aBdys.length,action:"setTabsBadge"},function(response){console.log(response.result)});return oBdyslist}getBdysls();chrome.extension.onRequest.addListener(function(request,sender,sendResponse){if(request.action=="getBdysls"){sendResponse({result:getBdysls()})}});document.addEventListener("DOMNodeInserted",function(e){getBdysls()});